这是一个非常棒的想法！多人同时进行的囚徒困境（N-player Prisoner's Dilemma）比二人版更加复杂且充满戏剧性，因为它引入了“搭便车”和“群体崩盘”的社会心理学效应。

由于你目前的 Agent 是基于 LLM 的，且每轮只能做一个统一的决策（对所有人 Cooperate 或对所有人 Defect），我推荐使用**“全员互联积分制”**。这是最符合现有逻辑的扩展方式。

以下是具体的规则设计方案：

### 方案一：全员互联积分制 (The Generalized Scoring)
这是将二人规则直接数学推广到 N 人。它的核心逻辑是：**你在这个回合的得分，等于你分别与场上其他所有玩家进行一次二人博弈的得分总和。**

#### 1. 计分公式
假设场上一共有 **$N$** 个玩家（你 + $N-1$ 个对手）。
在本轮中，假设除你之外，有 **$k$** 个对手选择了“合作”，那么剩下的 **$(N-1) - k$** 个对手选择了“背叛”。

你的得分计算如下：

*   **如果你选择【合作】 (Cooperate)**：
    *   你与 $k$ 个合作者达成“双赢”：得 $3 \times k$ 分
    *   你被剩下 $(N-1)-k$ 个背叛者“剥削”：得 $0$ 分
    *   **本轮总分 = $3k$**

*   **如果你选择【背叛】 (Defect)**：
    *   你“掠夺”了 $k$ 个合作者：得 $5 \times k$ 分
    *   你与剩下 $(N-1)-k$ 个背叛者“互斥”：得 $1 \times ((N-1)-k)$ 分
    *   **本轮总分 = $5k + (N - 1 - k)$**

#### 2. N=5 时的具体得分表（除自己外有4个对手）

| 对手行为 | 你的动作 | 计算过程 | **你的最终得分** | 评价 |
| :--- | :--- | :--- | :--- | :--- |
| **4人全合作** | **合作** | $3 \times 4$ | **12** | 共同富裕（帕累托最优） |
| **4人全合作** | **背叛** | $5 \times 4 + 0$ | **20** | 巨大的背叛诱惑！ |
| 2人合作 / 2人背叛 | **合作** | $3 \times 2$ | **6** | 勉强维持 |
| 2人合作 / 2人背叛 | **背叛** | $5 \times 2 + 1 \times 2$ | **12** | 即使混战，背叛也更有利 |
| **4人全背叛** | **合作** | $0$ | **0** | 彻底的悲剧（被轮流收割） |
| **4人全背叛** | **背叛** | $1 \times 4$ | **4** | 黑暗森林的低保（纳什均衡） |

**这个规则的特点：**
1.  **背叛总是优势策略**：无论对手怎么选，你选背叛的得分总是比选合作高（例如对手全合作时，你背叛得20分 > 合作得12分）。
2.  **集体困境依然存在**：大家都背叛（各得4分）远不如大家都合作（各得12分）。

---

### 方案二：公地悲剧模式 (The Tragedy of the Commons)
如果你想玩点不一样的，可以使用更具“社会实验”感的规则。

*   **规则**：每人拥有 10 点初始资金。
*   **选择**：
    *   **合作（贡献）**：你支付 10 点资金放入“公共池”。
    *   **背叛（保留）**：你不支付，私吞这 10 点。
*   **回报**：裁判将“公共池”里的资金总额 **翻 3 倍**，然后 **平分给所有人**（无论你是否贡献）。

**分析**：
*   如果你贡献：你付出10，池子增加10，翻倍成30，平分给5人，每人分到6。**你净亏损 4 (6-10)。但是队友每人赚了6。**
*   这是一个纯粹考验“利他”的规则。在绝对理性的计算下，所有人都会选择不贡献，最后大家一分钱分不到。

---

### 关键挑战：Agent 的感知能力调整

多人博弈最大的难点在于 **Prompt 的修改**。你的 Agent 之前习惯了“对手上一轮选了什么”，现在它面对的是一个群体。

你需要修改 `player_agent.py` 中的 `_format_history` 和 Prompt 模板，给 LLM 提供宏观数据。

**建议的 Prompt 描述方式：**

> “当前是多人混战模式，场上共有 5 名玩家。
> 上一轮结果：
> - 全场共有 3 人选择合作，2 人选择背叛。
> - 你选择了【合作】，因此你获得了 9 分（3个合作者 x 3分）。
> - 注意：如果你上一轮选择背叛，你本可以获得 17 分！”

**针对特殊 Agent 的策略适配：**

1.  **Tit-for-Tat (TFT)**：在多人局中，TFT 需要重新定义。
    *   *严格版*：只要上一轮有一个人背叛，我就背叛。
    *   *宽容版*：只有当背叛者超过半数（>2人），我才背叛。
    *   *建议*：让 LLM 自己决定阈值，告诉它：“作为 TFT，你的原则是惩罚破坏环境的人。如果环境恶劣（背叛者多），你就背叛；如果环境尚可，你就合作。”

2.  **Machiavellian (权谋型)**：
    *   它会非常喜欢多人局。它可能会尝试在第一轮合作以骗取大家信任，然后在大家放松警惕时（例如第3轮）突然背叛以收割 4 个人的 20 分。

你觉得哪种规则更有趣？如果是**方案一**，我可以为你提供修改后的 `GameReferee` 代码。